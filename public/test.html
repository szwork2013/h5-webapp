<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Demo</title>
<script type="text/javascript">
function F_Open_dialog()
{
document.getElementById("btn_file").click();
}

function change() {
  var files = document.getElementById('btn_file');
  var filesToUpload = files.files;
  var file = filesToUpload[0];

  var img = new Image();
  var reader = new FileReader();
  reader.onload = function(e) {
    img.src = e.target.result
  }
  reader.readAsDataURL(file);

  var obj = {
    width: 210,
    height: 130,
    quality: 1,
  }
  img.onload = function(){
    var that = this;
    // 默认按比例压缩
    var w = that.width,
     h = that.height,
     scale = w / h;
     w = obj.width || w;
     h = obj.height || (w / scale);
    var quality = 0.7;  // 默认图片质量为0.7
    //生成canvas
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    // 创建属性节点
    var anw = document.createAttribute("width");
    anw.nodeValue = w;
    var anh = document.createAttribute("height");
    anh.nodeValue = h;
    canvas.setAttributeNode(anw);
    canvas.setAttributeNode(anh);
    ctx.drawImage(that, 0, 0, w, h);
    // 图像质量
    if(obj.quality && obj.quality <= 1 && obj.quality > 0){
     quality = obj.quality;
    }
    // quality值越小，所绘制出的图像越模糊
    var base64 = canvas.toDataURL('image/jpeg', quality );
    var preview = new Image();
    preview.src = base64;
    document.getElementById('preview').append(preview);
  }
}

</script>
</head>
<body>
<div>
  <div id="preview" style="width:210px;height:130px;border:solid 1px #eee;">
  </div>
<input type="file" accept="image/*" id="btn_file" style="display:none" onchange="change()">
<button type="button" onclick="F_Open_dialog()">选择文件</button>
</div>

</body>
</html>
